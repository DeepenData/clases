---
title: "R Notebook"
output: html_notebook
---

```{r}
library(magrittr)
genes_url       <- 'https://raw.githubusercontent.com/DeepenData/clases/fb3e5b3f7c9aca0c13d7eebe217cde9fe6b087bf/04-filters-programacion-funcional-apply-map/recon3_genes_to_reactionIDs.csv'
metabolites_url <- 'https://raw.githubusercontent.com/DeepenData/clases/fb3e5b3f7c9aca0c13d7eebe217cde9fe6b087bf/04-filters-programacion-funcional-apply-map/recon3_metabolite_metadata.csv'
reactions_url   <- 'https://raw.githubusercontent.com/DeepenData/clases/fb3e5b3f7c9aca0c13d7eebe217cde9fe6b087bf/04-filters-programacion-funcional-apply-map/recon3_reactions_metadata.csv'
```

```{r message=FALSE, warning=FALSE}
library(tidyverse)
source("my_classes.R")
source("my_functions.R")

genes_df          <- import_my_csv(genes_url) 
human_genes       <- new("genes", indentifiers = genes_df["Gene_ID"], gene_to_reactions = genes_df["Reactions"]) %>% glimpse

reactions_df      <- import_my_csv(reactions_url) 
human_reactions   <- new("reactions", indentifiers =  reactions_df[c('rxn_ids','rxn_names')], stoichiometry = reactions_df['reactions'], subsystem = reactions_df["rxn_subsystems"]) %>% glimpse

metabolites_df    <- import_my_csv(metabolites_url) 
human_metabolites <- new("metabolites", indentifiers =metabolites_df['ID', 'Name'], compartemt = metabolites_df['Compartment'], formula = metabolites_df['Formula'])    %>% glimpse


create_metabolism_0 <- function(genes =  genes, reactions = reactions, metabolites = metabolites) {
  new("metabolism", genes =  genes, reactions = reactions, metabolites = metabolites) %>% glimpse}


human_metabolism_0  <- create_metabolism_0( genes =  human_genes, reactions = human_reactions, metabolites = human_metabolites)
```

```{r}
human_metabolism <- create_metabolism(genes =  import_my_csv(genes_url) , reactions = import_my_csv(reactions_url), metabolites = import_my_csv(metabolites_url))
```

Accessors:  setters and getters
```{r}
setGeneric("genes",   function(x) standardGeneric("genes"))
setMethod("genes", "metabolism", function(x) slot(x@genes, 'indentifiers')[[1]])

genes(human_metabolism)

setGeneric("genes<-", function(x, value) standardGeneric("genes<-"))
setMethod("genes<-", "metabolism", function(x, value) {
  x@age <- value
  x
})

```

```{r}
setGeneric("rxns_by_genes",   function(x) standardGeneric("rxns_by_genes"))
setMethod("rxns_by_genes", "metabolism", function(x){ 
  slot(x@genes, 'gene_to_reactions') -> gene_to_reactions
  slot(x@genes, 'indentifiers')  -> genes
  tibble(genes, gene_to_reactions )
  })
```


```{r}
rxns_by_genes(human_metabolism)
```


```{r}
setMethod("age<-", "Person", function(x, value) {
  x@age <- value
  x
})
```








